<!DOCTYPE html>
<html lang="zh-CN">

<head>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%220.9em%22  font-size=%2290%22>ğŸ </text></svg>">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ”æˆ‘çš„å¾…åŠ</title>
    <style>


        #calendarViewBtn {
    width: 100%;
    margin-top: 10px;
    padding: 10px 15px;
    background-color: #FF4351;
    outline: -webkit-focus-ring-color auto 1px;
    color: white;
    border: none;
    cursor: pointer;
    text-align: center;
    font-size: 16px;
}

#calendarViewBtn:hover {
    background-color: #ff7680; /* å’Œ + æŒ‰é’®ä¸€æ ·çš„æ‚¬åœæ•ˆæœ */
}




        body {
            font-family: Arial, sans-serif;
                max-width: 720px; /* æœ€å¤§å®½åº¦ */
    margin: 25px auto;    /* æ°´å¹³å±…ä¸­ */
    padding: 0 20px;   /* å†…è¾¹è·ï¼Œé˜²æ­¢å†…å®¹ç´§è´´è¾¹ç¼˜ */
        }



        .date-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
background-color: #fec04e;
            border-bottom: 2px solid #ccc;
                        outline: -webkit-focus-ring-color auto 1px;
                        color: #221f1f;

        }
        .arrow {
            cursor: pointer;
            font-size: 20px;
            padding: 0 10px;
        }
        .days {
            display: flex;
            justify-content: space-between;
            flex-grow: 1;
            margin: 0 10px;
        }
        .day {
            position: relative;
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
                .todo-item:hover .todo-buttons, .todo-item.editing .todo-buttons {
            display: inline-block;
        }
        .todo-buttons {
            display: none;
        }

        .day:hover {
            background-color: #ffda97;
            border-radius: 6px;
                                    color: #221f1f;
        }
        .active {
            background-color: #ffda97;
            font-weight: bold;
            border-radius: 6px;
                                    color: #221f1f;

        }
        .today {
            font-weight: bold;
        }
        .badge {
            position: absolute;
            top: 5px;
            right: 10px;
            background-color: #FF4351;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
        }
        .todo-container {
            margin-top: 20px;

            padding-right: 20px;

            padding-left: 20px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            outline: -webkit-focus-ring-color auto 1px;
        }
        /* æ–°å¢æ ·å¼ä»¥è°ƒæ•´æ—¥æœŸé€‰æ‹©å™¨çš„ä½ç½® */
        .date-picker-container {
            display: flex;
            align-items: center;
            margin-left: 10px; /* è°ƒæ•´é—´è· */
        }
        #datePicker {
            display: none; /* åˆå§‹éšè— */
          /* margin-right: 10px;  æŒ‰é’®ä¸æ—¥æœŸé€‰æ‹©å™¨ä¹‹é—´çš„é—´è· */
        }
        .todo-item {
            display: flex;
            align-items: center;
            padding: 5px;
            border-bottom: 1px solid #ccc;
            justify-content: space-between;
        }
        .todo-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            margin-right: 10px;
        }
        .todo-text {
            flex-grow: 1;
    color: #131315;

font-size: 16px;
padding-top: 15px;
    padding-right: 15px;
    padding-bottom: 15px;
    padding-left: 1px;
            margin-right: 10px;
            border: none;
            outline: none;
            background-color: #fff;
        }
        .todo-text[disabled] {
            background-color: #f9f9f9;
        }
        .completed {
            text-decoration: line-through;
            color: #888;
        }

.todo-buttons .delete-confirm {
    background-color: #FF4351 ;
    color: white;
    border-color: #FF4351;
    border: none;
    background: #FF4351;
}


.todo-buttons button {
    animation-name: glowing-primary;
    border-color: #088ef0;
    background: linear-gradient(#34a5f8, #088ef0);
    color: #FFF;
    margin: 2.5px;
    border-style: solid;
    border-width: 1px;
    line-height: 25px;
    border-radius: 4px;
    text-align: center;
    border: none;
}

.calendar-day.today {
    background-color: #fffeaa; /* ä»Šæ—¥çš„èƒŒæ™¯ */
    color: black; /* åè‰²æ˜¾ç¤º */
    font-size: 12px;
    white-space: nowrap;
}
.calendar-nav {
    display: flex;
    justify-content: center; /* ä¸­å¿ƒå¯¹é½ */
    align-items: center;
    padding: 28px; /* æ·»åŠ å†…è¾¹è· */
    border-bottom: 2px solid #ccc; /* è¾¹æ¡† */
    background-color: #fec04e;
    outline: -webkit-focus-ring-color auto 1px;
    color: #221f1f;
    font-weight: bold;
}

.calendar-header {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    text-align: center;
    font-weight: bold;
    padding-top: 28px;
    padding-bottom: 28px;
}

.calendar-body {
    display: grid;
    grid-template-columns: repeat(7, 1fr); /* ä¸ƒåˆ— */
    grid-template-rows: repeat(autofill, 1fr); /* è¡Œè‡ªé€‚åº” */
    height: 60vh; /* å æ®æ•´ä¸ªè§†å£é«˜åº¦ */

    gap: 10px; /* å¯é€‰ï¼Œè®¾ç½®æ ¼å­ä¹‹é—´çš„é—´è· */

}

.calendar-day {
    border: 1px solid #ddd;
    padding: 10px;
    position: relative;
        font-size: 12px;
    white-space: nowrap;         /* ç¦ç”¨æ¢è¡Œ */
    overflow: hidden;           /* éšè—æº¢å‡ºçš„å†…å®¹ */
}
        #addTodo {
            width: 100%;
            margin-top: 10px;
            outline: -webkit-focus-ring-color auto 1px;
            padding: 10px 15px;
            background-color: #A5DE37;
            color: black;
            border: none;
            cursor: pointer;
            text-align: center;
            font-size: 16px;
        }
        #addTodo:hover {
            background-color: #b9e563
        }

    </style>
</head>
<body>







    <!-- æ—¥æœŸå¯¼èˆªéƒ¨åˆ† -->
    <div class="date-nav">
        <span class="arrow" id="prevDay">&lt;</span>
        <div class="days" id="daysContainer">
            <!-- æ—¥æœŸå°†ä¼šåŠ¨æ€ç”Ÿæˆ -->
        </div>
        <span class="arrow" id="nextDay">&gt;</span>
    </div>

    <!-- å¾…åŠåˆ—è¡¨éƒ¨åˆ† -->
    <div class="todo-container" id="todoContainer">
        <!-- å¾…åŠäº‹é¡¹å°†ä¼šåœ¨è¿™é‡Œç”Ÿæˆ -->
    </div>




    <!-- æ—¥å†è§†å›¾éƒ¨åˆ† -->
<div id="calendarView" style="display: none;">
    <div class="calendar-nav">
        <span class="arrow" id="prevMonth">&lt;</span>
        <span id="viewLabel">å‘¨è§†å›¾</span>
        <span class="arrow" id="nextMonth">&gt;</span>
    </div>
    <div class="calendar-header">
        <span>å‘¨ä¸€</span>
        <span>å‘¨äºŒ</span>
        <span>å‘¨ä¸‰</span>
        <span>å‘¨å››</span>
        <span>å‘¨äº”</span>
        <span>å‘¨å…­</span>
        <span>å‘¨æ—¥</span>
    </div>
    <div class="calendar-body" id="calendarBody">
        <!-- æ—¥å†å¤©æ•°å°†ä¼šåŠ¨æ€ç”Ÿæˆ -->
    </div>
</div>




<button id="chooseDateBtn" style="display: none;">é€‰æ‹©æ—¥æœŸ</button>
<input type="date" id="datePicker" style="display: none;">

    <button id="addTodo">â•</button>
    <button id="calendarViewBtn">ğŸ“…æ—¥å†è§†å›¾</button>
    <script>
            // è·å–å…ƒç´ 
    const chooseDateBtn = document.getElementById('chooseDateBtn');
    const datePicker = document.getElementById('datePicker');
    let editingTodoId = null; // ç”¨äºä¿å­˜å½“å‰æ­£åœ¨ç¼–è¾‘çš„å¾…åŠé¡¹çš„ID

    // æ—¥æœŸé€‰æ‹©æŒ‰é’®äº‹ä»¶ï¼Œç‚¹å‡»åå¼¹å‡ºæ—¥æœŸé€‰æ‹©å™¨
    chooseDateBtn.addEventListener('click', () => {
        if (editingTodoId !== null) {
            const todo = todosByDate[currentSelectedDate].find(todo => todo.id === editingTodoId);
            if (todo) {
            if (todo) {
                // æ˜¾ç¤ºæ—¥æœŸé€‰æ‹©å™¨å¹¶è®¾ç½®é»˜è®¤å€¼ä¸ºå½“å‰å¾…åŠäº‹é¡¹çš„æ—¥æœŸ
                datePicker.value = currentSelectedDate;
                datePicker.style.display = 'inline-block';
                //datePicker.focus(); // ä½¿æ—¥æœŸé€‰æ‹©å™¨è‡ªåŠ¨è·å¾—ç„¦ç‚¹
                }
            }
        }
    });

        // ç›‘å¬ç”¨æˆ·é€‰æ‹©æ—¥æœŸçš„äº‹ä»¶
    datePicker.addEventListener('change', (event) => {
        const selectedDate = event.target.value;

        if (selectedDate && editingTodoId !== null) {
            updateTodoDate(editingTodoId, selectedDate);
        }
        datePicker.style.display = 'none';
    });


        let currentDate = new Date(); // å½“å‰æ˜¾ç¤ºçš„å¼€å§‹æ—¥æœŸ
        const daysContainer = document.getElementById("daysContainer");

        let todosByDate = {};
        const todoContainer = document.getElementById('todoContainer');
        const addTodoBtn = document.getElementById('addTodo');
        let currentSelectedDate = formatDate(currentDate); // åˆå§‹æ—¥æœŸ

        let draggedTodo = null; // å­˜å‚¨è¢«æ‹–åŠ¨çš„å¾…åŠä¿¡æ¯

        function loadTodos() {
            const storedData = localStorage.getItem('todosByDate');
            if (storedData) {
                todosByDate = JSON.parse(storedData);
            }
        }

      function saveTodos() {
    const todosToSave = {};
    let hasValidTodos = false; // ç”¨äºè·Ÿè¸ªæ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„ todos

    for (const date in todosByDate) {
        // è¿‡æ»¤æ‰ç©ºæ–‡æœ¬çš„ todos
        const validTodos = todosByDate[date].filter(todo => todo.text.trim() !== '');
        
        if (validTodos.length > 0) {
            hasValidTodos = true; // å¦‚æœæœ‰æœ‰æ•ˆçš„ todosï¼Œåˆ™æ ‡è®°ä¸º true
            todosToSave[date] = validTodos.map(todo => ({
                id: todo.id,
                text: todo.text,
                completed: todo.completed
                // ä¸å†ä¿å­˜ editing å’Œ deleteConfirmed
            }));
        }
    }

    // åªæœ‰åœ¨æœ‰æœ‰æ•ˆ todos çš„æƒ…å†µä¸‹æ‰ä¿å­˜åˆ° localStorage
    if (hasValidTodos) {
        localStorage.setItem('todosByDate', JSON.stringify(todosToSave));

    } else {
        // å¦‚æœæ²¡æœ‰æœ‰æ•ˆçš„ todosï¼Œåˆ™æ¸…ç©º localStorage
        localStorage.removeItem('todosByDate');

    }
}

        function formatDate(date) {
            const offsetDate = new Date(date.getTime() + (8 * 60 * 60 * 1000)); // Offset for GMT+8
            return offsetDate.toISOString().split('T')[0]; // è¿”å› YYYY-MM-DD æ ¼å¼
        }

        // ç”Ÿæˆ7å¤©çš„æ—¥æœŸæ˜¾ç¤º (å§‹ç»ˆä»¥å‘¨ä¸€ä¸ºå¼€å§‹)
        function updateDays() {
            daysContainer.innerHTML = '';
            const dayOfWeek = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
            let tempDate = new Date(currentDate);
            const dayOffset = tempDate.getDay() === 0 ? 6 : tempDate.getDay() - 1;
            tempDate.setDate(tempDate.getDate() - dayOffset); // å›åˆ°å‘¨ä¸€

            for (let i = 0; i < 7; i++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'day';
                const formattedDate = formatDate(tempDate);

                dayDiv.innerHTML = `${dayOfWeek[tempDate.getDay()]}<br>${tempDate.getMonth() + 1}-${tempDate.getDate()}`;
                dayDiv.setAttribute("data-date", formattedDate);

                const pendingTodos = (todosByDate[formattedDate] || []).filter(todo => !todo.completed).length;
                if (pendingTodos > 0) {
                    const badge = document.createElement('span');
                    badge.className = 'badge';
                    badge.textContent = pendingTodos;
                    dayDiv.appendChild(badge);
                }

                dayDiv.addEventListener('dragover', (e) => e.preventDefault());
                dayDiv.addEventListener('drop', (e) => handleDrop(e, formattedDate));
                dayDiv.addEventListener('click', (e) => {
                    const selectedDate = e.target.getAttribute("data-date");
                    Array.from(daysContainer.children).forEach(d => d.classList.remove('active'));
                    e.target.classList.add('active');

                    showTodoList(selectedDate);
                });

                if (formattedDate === formatDate(new Date())) {
                    dayDiv.classList.add('today');
                }

                if (formattedDate === currentSelectedDate) {
                    dayDiv.classList.add('active');
                }

                daysContainer.appendChild(dayDiv);
                tempDate.setDate(tempDate.getDate() + 1);
            }
        }

        function showTodoList(date) {
            currentSelectedDate = date;

            renderTodoList();
        }

        function renderTodoList() {
            todoContainer.innerHTML = '';
            const todos = todosByDate[currentSelectedDate] || [];

            const uncompletedTodos = todos.filter(todo => !todo.completed);
            const completedTodos = todos.filter(todo => todo.completed);

            uncompletedTodos.forEach(todo => createTodoElement(todo));
            completedTodos.forEach(todo => createTodoElement(todo));
                // èšç„¦åˆ°æœ€åä¸€ä¸ªæ–°å¢çš„æˆ–æ­£åœ¨ç¼–è¾‘çš„å¾…åŠ
    const editingTodo = todos.find(todo => todo.editing);
    if (editingTodo) {
        const inputField = Array.from(todoContainer.children).find(item => item.querySelector('.todo-text').value === editingTodo.text);
        if (inputField) {
            inputField.querySelector('.todo-text').focus();

        }
    } else {
        const lastTodo = Array.from(todoContainer.children).slice(-1)[0];
        if (lastTodo) {
            lastTodo.querySelector('.todo-text').focus();
        }
    }

            updateDays();
            saveTodos();
        }

        function createTodoElement(todo) {
            const todoElement = document.createElement('div');
            todoElement.className = 'todo-item';
            todoElement.setAttribute('draggable', true);
            todoElement.addEventListener('dragstart', () => handleDragStart(todo));

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'todo-checkbox';
            checkbox.checked = todo.completed;
            checkbox.addEventListener('click', () => toggleComplete(todo.id));
            todoElement.appendChild(checkbox);

            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'todo-text';
            input.value = todo.text;
            input.disabled = !todo.editing;
            if (todo.completed) input.classList.add('completed');
            input.addEventListener('dblclick', () => editTodoText(todo.id)); // åŒå‡»è¿›å…¥ç¼–è¾‘æ¨¡å¼
            todoElement.appendChild(input);

            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'todo-buttons';

            if (todo.editing) {
                todoElement.classList.add('editing');
                            todoElement.setAttribute('draggable', false);

    // åˆ›å»ºé€‰æ‹©æ—¥æœŸæŒ‰é’®
    const chooseDateBtn = document.createElement('button');
    chooseDateBtn.textContent = 'é€‰æ‹©æ—¥æœŸ';
            // æ–°å¢æ—¥æœŸé€‰æ‹©å™¨å®¹å™¨
        const datePickerContainer = document.createElement('div');
        datePickerContainer.className = 'date-picker-container';
    // é€‰æ‹©æ—¥æœŸæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶
    chooseDateBtn.addEventListener('click', () => {
        // æ˜¾ç¤ºæ—¥æœŸé€‰æ‹©å™¨å¹¶è®¾ç½®é»˜è®¤å€¼ä¸ºå½“å‰å¾…åŠäº‹é¡¹çš„æ—¥æœŸ
        datePicker.value = currentSelectedDate; // ä½¿ç”¨å½“å‰é€‰å®šçš„æ—¥æœŸ
        datePicker.style.display = 'inline-block'; // æ˜¾ç¤ºæ—¥æœŸé€‰æ‹©å™¨
        //datePicker.focus(); // èšç„¦åˆ°æ—¥æœŸé€‰æ‹©å™¨
        chooseDateBtn.style.display = 'none'; 



      // éå†æ‰€æœ‰æŒ‰é’®ï¼ŒæŸ¥æ‰¾æ–‡æœ¬ä¸ºâ€œç¡®å®šâ€çš„æŒ‰é’®      
const buttons = document.querySelectorAll('button');
    buttons.forEach(button => {
if (button.textContent.trim() === 'ç¡®å®š' || button.textContent.trim() === 'åˆ é™¤') {
    button.style.display = 'none'; 

}
    });  


    });

        // å°†æ—¥æœŸé€‰æ‹©å™¨å’ŒæŒ‰é’®æ·»åŠ åˆ°å®¹å™¨ä¸­
        datePickerContainer.appendChild(datePicker);
        datePickerContainer.appendChild(chooseDateBtn);
        buttonContainer.appendChild(datePickerContainer); 
                const saveBtn = document.createElement('button');
                saveBtn.textContent = 'ç¡®å®š';
                saveBtn.addEventListener('click', () => saveTodoText(todo.id, input.value));

                buttonContainer.appendChild(saveBtn);
                input.addEventListener('keydown', (event) => {
                    if (event.key === 'Enter') {
                        saveTodoText(todo.id, input.value);
                    }
                });
                input.focus(); // è‡ªåŠ¨èšç„¦
            } else {
                const editBtn = document.createElement('button');
                editBtn.textContent = 'ç¼–è¾‘';
                editBtn.addEventListener('click', () => {
                    editTodoText(todo.id);
                    input.focus(); // ç¼–è¾‘æ—¶è‡ªåŠ¨èšç„¦åˆ°è¾“å…¥æ¡†
                });


datePicker.addEventListener('change', (event) => {
    const selectedDate = event.target.value;

    if (selectedDate && editingTodoId !== null) {
        updateTodoDate(editingTodoId, selectedDate); // æ›´æ–°å¾…åŠäº‹é¡¹çš„æ—¥æœŸ

    }
    datePicker.style.display = 'none'; // éšè—æ—¥æœŸé€‰æ‹©å™¨
});                
                buttonContainer.appendChild(editBtn);

            }

const deleteBtn = document.createElement('button');
deleteBtn.textContent = todo.deleteConfirmed ? 'ç¡®è®¤åˆ é™¤' : 'åˆ é™¤';
datePicker.style.display = 'none';
deleteBtn.classList.toggle('delete-confirm', todo.deleteConfirmed);
deleteBtn.addEventListener('click', () => {

    confirmDelete(todo.id);
    console.log("ç‚¹åˆ é™¤");
    chooseDateBtn.style.display = 'none';

});

// æ·»åŠ  mouseenter å’Œ mouseleave äº‹ä»¶ç›‘å¬å™¨
deleteBtn.addEventListener('mouseenter', () => {
    if (todo.deleteConfirmed) {
        deleteBtn.textContent = 'ç¡®è®¤åˆ é™¤'; // é¼ æ ‡æ‚¬åœæ—¶ä¿æŒç¡®è®¤åˆ é™¤


    }
});

deleteBtn.addEventListener('mouseleave', () => {
    deleteBtn.textContent = 'åˆ é™¤'; // é¼ æ ‡ç§»å¼€æ—¶æ¢å¤æ–‡æœ¬

                    todo.deleteConfirmed=false;
});

buttonContainer.appendChild(deleteBtn);

            todoElement.appendChild(buttonContainer);
            todoContainer.appendChild(todoElement);
        }

        function handleDragStart(todo) {
    const currentDateElement = document.querySelector('.calendar-day.active'); // è·å–å½“å‰é€‰ä¸­æ—¥æœŸçš„å…ƒç´ 
    const currentDate = currentDateElement ? currentDateElement.getAttribute('data-date') : currentSelectedDate; // è·å–å½“å‰é€‰ä¸­æ—¥æœŸ
    draggedTodo = { ...todo, sourceDate: currentDate }; // å°†å½“å‰æ—¥æœŸè®¾ç½®ä¸ºæºæ—¥æœŸ
        }

      function handleDrop(event, targetDate) {
    event.preventDefault(); // é˜²æ­¢é»˜è®¤è¡Œä¸º

    if (draggedTodo) {
        // ä»åŸæ—¥æœŸä¸­åˆ é™¤
        todosByDate[draggedTodo.sourceDate] = todosByDate[draggedTodo.sourceDate].filter(todo => todo.id !== draggedTodo.id);
        // æ·»åŠ åˆ°ç›®æ ‡æ—¥æœŸ
        todosByDate[targetDate] = todosByDate[targetDate] || [];
        todosByDate[targetDate].push(draggedTodo);

        // æ›´æ–°å½“å‰é€‰ä¸­æ—¥æœŸçš„å¾…åŠåˆ—è¡¨
        if (currentSelectedDate === draggedTodo.sourceDate || currentSelectedDate === targetDate) {
            renderTodoList();
        }

        draggedTodo = null; // æ¸…ç©ºè¢«æ‹–åŠ¨çš„å¾…åŠä¿¡æ¯
        saveTodos();
        updateDays();
        renderCalendar(); // é‡æ–°æ¸²æŸ“æ—¥å†

    }
}


        function addNewTodo() {
            const newTodo = {
                id: Date.now(),
                text: '',
                completed: false,
                editing: true,
                deleteConfirmed: false
            };
            // ä¸å°†ç©ºçš„æ–°å¢å¾…åŠå­˜å‚¨
            todosByDate[currentSelectedDate] = todosByDate[currentSelectedDate] || [];
            todosByDate[currentSelectedDate].push(newTodo);
            datePicker.style.display = 'none';
            renderTodoList();

            const inputFields = document.querySelectorAll('.todo-text');
            inputFields[inputFields.length - 1].focus(); // å…‰æ ‡è‡ªåŠ¨èšç„¦


            const buttons = document.querySelectorAll('button');

    // éå†æ‰€æœ‰æŒ‰é’®ï¼ŒæŸ¥æ‰¾æ–‡æœ¬ä¸ºâ€œç¡®å®šâ€çš„æŒ‰é’®
    buttons.forEach(button => {
        if (button.textContent.trim() === 'é€‰æ‹©æ—¥æœŸ') {
            button.style.display = 'none'; 
        }
    });  

        


        }

        function toggleComplete(id) {
            todosByDate[currentSelectedDate] = todosByDate[currentSelectedDate].map(todo => {
                if (todo.id === id) {
                    todo.completed = !todo.completed;
                }
                return todo;
            });
            renderTodoList();
        }

        function saveTodoText(id, newText) {
    todosByDate[currentSelectedDate] = todosByDate[currentSelectedDate].map(todo => {
        if (todo.id === id) {
            if (!newText.trim()) {
                return null; // å¦‚æœæ–‡æœ¬ä¸ºç©ºï¼Œåˆ™åˆ é™¤å¾…åŠ
            }
            todo.text = newText;
            // ä¸å†ä¿å­˜ editing çŠ¶æ€
            todo.editing = false;
        }
        return todo;
    }).filter(todo => todo !== null); // è¿‡æ»¤æ‰ç©ºæ–‡æœ¬çš„å¾…åŠ
    renderTodoList();
            chooseDateBtn.style.display = 'none'; // éšè— "é€‰æ‹©æ—¥æœŸ" æŒ‰é’®
        editingTodoId = null; // æ¸…ç©ºç¼–è¾‘ä¸­çš„ID
        }

        function editTodoText(id) {
    todosByDate[currentSelectedDate] = todosByDate[currentSelectedDate].map(todo => {
        if (todo.id === id) {
            todo.editing = true;
            editingTodoId = id; // ä¿å­˜æ­£åœ¨ç¼–è¾‘çš„å¾…åŠID
        }
        return todo;
    });
    chooseDateBtn.style.display = 'none'; // æ˜¾ç¤º "é€‰æ‹©æ—¥æœŸ" æŒ‰é’®
    renderTodoList();
        }
 function updateTodoDate(id, newDate) {

        // ä»å½“å‰æ—¥æœŸç§»é™¤è¯¥å¾…åŠäº‹é¡¹
        const todo = todosByDate[currentSelectedDate].find(todo => todo.id === id);
        if (todo) {
            // ä»å½“å‰æ—¥æœŸç§»é™¤è¯¥å¾…åŠäº‹é¡¹
            todosByDate[currentSelectedDate] = todosByDate[currentSelectedDate].filter(todo => todo.id !== id);
            // å°†å¾…åŠäº‹é¡¹æ·»åŠ åˆ°æ–°æ—¥æœŸ
            todosByDate[newDate] = todosByDate[newDate] || [];
            todosByDate[newDate].push(todo);
            currentSelectedDate = newDate; // æ›´æ–°å½“å‰é€‰ä¸­çš„æ—¥æœŸ
            renderTodoList();
              const buttons = document.querySelectorAll('button');

    // éå†æ‰€æœ‰æŒ‰é’®ï¼ŒæŸ¥æ‰¾æ–‡æœ¬ä¸ºâ€œç¡®å®šâ€çš„æŒ‰é’®
    buttons.forEach(button => {
        if (button.textContent.trim() === 'ç¡®å®š') {
            button.click(); // ç‚¹å‡»æŒ‰é’®
        }
    });  

        }
        chooseDateBtn.style.display = 'none'; // éšè— "é€‰æ‹©æ—¥æœŸ" æŒ‰é’®
        editingTodoId = null; // æ¸…ç©ºç¼–è¾‘ä¸­çš„ID
    }
        function confirmDelete(id) {
            

        chooseDateBtn.style.display = 'none'




            todosByDate[currentSelectedDate] = todosByDate[currentSelectedDate].map(todo => {

                if (todo.id === id) {
                    if (todo.deleteConfirmed) {
                        return null;
                        
                    }
                    todo.deleteConfirmed = true;
                }

                return todo;
            }).filter(todo => todo !== null);

            renderTodoList();
        }

        document.getElementById("prevDay").addEventListener('click', () => {
            currentDate.setDate(currentDate.getDate() - 7);
            updateDays();
        });

        document.getElementById("nextDay").addEventListener('click', () => {
            currentDate.setDate(currentDate.getDate() + 7);
            updateDays();
        });

        addTodoBtn.addEventListener('click', addNewTodo);

        function moveUncompletedTodosToToday() {
            const today = formatDate(new Date());
            for (let date in todosByDate) {
                if (date < today) {
                    const uncompletedTodos = todosByDate[date].filter(todo => !todo.completed);
                    if (uncompletedTodos.length > 0) {
                        todosByDate[today] = (todosByDate[today] || []).concat(uncompletedTodos);
                        todosByDate[date] = todosByDate[date].filter(todo => todo.completed);
                    }
                }
            }
        }

        loadTodos();
        moveUncompletedTodosToToday();
        updateDays();
        renderTodoList();




let isCalendarView = false; // è·Ÿè¸ªæ˜¯å¦åœ¨æ—¥å†è§†å›¾ä¸­
const calendarViewBtn = document.getElementById("calendarViewBtn");
const calendarBody = document.getElementById("calendarBody");
const viewLabel = document.getElementById("viewLabel");

calendarViewBtn.addEventListener('click', toggleCalendarView);
document.getElementById("prevMonth").addEventListener('click', () => changeMonth(-1));
document.getElementById("nextMonth").addEventListener('click', () => changeMonth(1));

function toggleCalendarView() {
    isCalendarView = !isCalendarView;
    document.getElementById("todoContainer").style.display = isCalendarView ? 'none' : 'block';
    document.getElementById("calendarView").style.display = isCalendarView ? 'block' : 'none';
// æ§åˆ¶æ—¥æœŸå¯¼èˆªçš„æ˜¾ç¤ºä¸éšè—
    document.querySelector('.date-nav').style.display = isCalendarView ? 'none' : 'flex';
        calendarViewBtn.textContent = isCalendarView ? 'ğŸ•”ï¸å‘¨è§†å›¾' : 'ğŸ“…æ—¥å†è§†å›¾';
            const addTodoButton = document.getElementById("addTodo");
    addTodoButton.style.display = isCalendarView ? 'none' : 'block';


    if (isCalendarView) {
        renderCalendar();
    }

        if (!isCalendarView) {
            location.reload(); // Reloads the current page
        currentSelectedDate = formatDate(currentDate); // è®¾ç½®å½“å‰é€‰ä¸­æ—¥æœŸä¸ºå½“å‰æ—¥æœŸ
        //renderTodoList();  æ¸²æŸ“å¾…åŠäº‹é¡¹åˆ—è¡¨
        //renderCalendar();
    }
}

let currentMonth = new Date(); // å½“å‰æ˜¾ç¤ºçš„æœˆä»½

function changeMonth(direction) {
    currentMonth.setMonth(currentMonth.getMonth() + direction);
    renderCalendar();
}
function updateViewLabel(year, month) {
    const viewLabel = document.getElementById("viewLabel");
    viewLabel.textContent = `${year}å¹´${month}æœˆ`;
}


function renderCalendar() {  
    calendarBody.innerHTML = '';
    const year = currentMonth.getFullYear();
    const month = currentMonth.getMonth();
    const now = new Date();
    updateViewLabel(year, month+1);

    // è·å–å½“æœˆç¬¬ä¸€å¤©
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0); // è·å–ä¸Šä¸ªæœˆæœ€åä¸€å¤©
    const startDay = firstDay.getDay(); // å‘¨å‡ å¼€å§‹


    // æ·»åŠ å‰ç½®ç©ºæ ¼
    for (let i = 1; i < startDay; i++) {
        const emptyDay = document.createElement('div');
        calendarBody.appendChild(emptyDay);
    }

    // æ·»åŠ æ¯ä¸€å¤©çš„æ•°å­—
    for (let day = 1; day <= lastDay.getDate(); day++) {
        const dayDiv = document.createElement('div');
        dayDiv.className = 'calendar-day';
        dayDiv.textContent = day;

        // æ ‡è®°ä»Šå¤©
        if (day === new Date().getDate() && month === new Date().getMonth() && year === new Date().getFullYear()) {
            dayDiv.classList.add('today');
        }

        // æ·»åŠ å¾…åŠäº‹é¡¹
const formattedDate = `${year}-${month + 1}-${day}`;
const todos = todosByDate[formattedDate] || [];
todos.forEach(todo => {
    const todoText = document.createElement('div');
    todoText.textContent = `Â· ${todo.text}`; // æ·»åŠ ç¬¦å·
    if (todo.completed) {
        todoText.classList.add('completed');
    }
 // è®¾ç½®ä¸ºå¯æ‹–åŠ¨

            todoText.setAttribute('draggable', true);









let isDragging = false;
let clickCount = 0; // è®°å½•ç‚¹å‡»æ¬¡æ•°

todoText.addEventListener('dragstart', (e) => {
    isDragging = true; // è®¾ç½®æ‹–åŠ¨æ ‡å¿—

    handleDragStart(todo); // æ‹–åŠ¨å¼€å§‹
});

dayDiv.addEventListener('mousedown', () => {
    clickCount = 0; // é‡ç½®ç‚¹å‡»æ¬¡æ•°
    currentSelectedDate = formattedDate; // æ›´æ–°å½“å‰é€‰ä¸­æ—¥æœŸ

    renderCalendar(); // é‡æ–°æ¸²æŸ“æ—¥å†ä»¥é«˜äº®æ˜¾ç¤ºé€‰ä¸­æ—¥æœŸ
});

todoText.addEventListener('mousedown', () => {
    clickCount++; // å¢åŠ ç‚¹å‡»æ¬¡æ•°

    if (clickCount === 2) { // æ£€æµ‹åŒå‡»

        if (!isDragging) { // å¦‚æœæ²¡æœ‰æ‹–åŠ¨ï¼Œæ‰§è¡ŒåŒå‡»äº‹ä»¶
            toggleComplete(todo.id); // åˆ‡æ¢ä»»åŠ¡çŠ¶æ€
            renderCalendar(); // æ›´æ–°æ—¥å†è§†å›¾
        }
        clickCount = 0; // é‡ç½®ç‚¹å‡»æ¬¡æ•°
    }
});

// æ‹–åŠ¨ç»“æŸæ—¶é‡ç½®æ‹–åŠ¨æ ‡å¿—
todoText.addEventListener('dragend', () => {
    isDragging = false; // é‡ç½®æ‹–åŠ¨çŠ¶æ€
});









                // æ›´æ–° currentSelectedDate

            dayDiv.appendChild(todoText);
        });



                // æ›´æ–°å½“å‰é€‰ä¸­æ—¥æœŸ





        dayDiv.setAttribute("data-date", formattedDate);
        dayDiv.addEventListener('dragover', (e) => e.preventDefault());
        dayDiv.addEventListener('drop', (e) => handleDrop(e, formattedDate));
        calendarBody.appendChild(dayDiv);
    }
}

document.addEventListener('keydown', function(event) {
    if (event.ctrlKey && event.key === '.') {
        const todosByDate = JSON.parse(localStorage.getItem('todosByDate'));
        let output = '';

        for (const [date, todos] of Object.entries(todosByDate)) {
            output += `## ${date}\n\n`;
            todos.forEach(todo => {
                const completedMarker = todo.completed ? '[x]' : '[ ]';
                output += `- ${completedMarker} ${todo.text}\n`;
            });
            output += '\n'; // æ·»åŠ ç©ºè¡Œä»¥åˆ†éš”æ—¥æœŸ
        }

        const newTab = window.open();
        newTab.document.write('<pre>' + output.trim() + '</pre>');
        newTab.document.close(); // å…³é—­æ–‡æ¡£æµä»¥å®Œæˆé¡µé¢åŠ è½½

    } else if (event.ctrlKey && event.key === '/') {
        const helpTab = window.open();
        helpTab.document.write(`
            <html>
                <head>
                    <title>ä½¿ç”¨è¯´æ˜</title>
                    


                </head>
                <body>
                    <h1>ä½¿ç”¨è¯´æ˜</h1>
                    <p>1. ç‚¹å‡»æ—¥æœŸå¯ä»¥åˆ‡æ¢æ—¥æœŸï¼Œç‚¹å‡»<>å¯ä»¥åˆ‡æ¢ä¸Šä¸€å‘¨ã€ä¸‹ä¸€å‘¨</p>
                    <p>2. ç‚¹å‡»+æ–°å¢å¾…åŠ</p>
                    <p>3. ç‚¹å‡»ç¼–è¾‘æŒ‰é’®ä¿®æ”¹å¾…åŠå†…å®¹</p>
                    <p>4. ç‚¹å‡»é€‰æ‹©æ—¥æœŸï¼Œå¯ä»¥å°†ä»»åŠ¡ç§»åŠ¨åˆ°å…¶ä»–æ—¥æœŸ</p>
                    <p>5. å¯ä»¥æ‹–åŠ¨ä»»åŠ¡åˆ°å…¶ä»–æ—¥æœŸ</p>
                    <p>6. å‰æœŸæœªå®Œæˆçš„ä»»åŠ¡ä¼šè‡ªåŠ¨è½¬ç§»åˆ°ä»Šå¤©ï¼Œå·²å®Œæˆçš„ä¸ä¼šè½¬ç§»</p>
                    <p>7. ç‚¹å‡»æ—¥å†è§†å›¾å¯ä»¥çœ‹æ•´ä¸ªæœˆå·²å®Œæˆã€æœªå®Œæˆçš„ä»»åŠ¡</p>
                    <p>8. æ—¥å†è§†å›¾ä¸‹ï¼Œå¯ä»¥æ‹–åŠ¨æ”¹å˜ä»»åŠ¡æ—¥æœŸ</p>
                    <p>9. ctrl+. å¯ä»¥ä»¥markdownæ ¼å¼å¯¼å‡ºæ‰€æœ‰ä»»åŠ¡</p>
                    <p>10. ctrl+/ å¯ä»¥æ˜¾ç¤ºè¯´æ˜ </p>
                </body>
            </html>
        `);
        helpTab.document.close(); // å…³é—­æ–‡æ¡£æµä»¥å®Œæˆé¡µé¢åŠ è½½
    }
});

    </script>
</body>
</html>
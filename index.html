<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%220.9em%22  font-size=%2290%22>ğŸ </text></svg>">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ”æˆ‘çš„å¾…åŠ</title>
    <style>
        #calendarViewBtn {
            width: 100%;
            margin-top: 10px;
            padding: 10px 15px;
            background-color: #FF4351;
            border-radius: 2px; /* åœ†è§’æ•ˆæœ */
            box-shadow: 0 0 0 2px black; /* æ¨¡æ‹Ÿ outline */
            color: white;
            border: none;
            cursor: pointer;
            text-align: center;
            font-size: 16px;
            font-family: sans-serif;
        }
        
        #calendarViewBtn:hover {
            background-color: #ff7680; /* å’Œ + æŒ‰é’®ä¸€æ ·çš„æ‚¬åœæ•ˆæœ */
        }
        
        .status {

    font-size: 14px;
    text-align: right;
    padding-top: 10px;

}
        
        
        body {
            font-family: sans-serif;
                max-width: 720px; /* æœ€å¤§å®½åº¦ */
            margin: 25px auto;    /* æ°´å¹³å±…ä¸­ */
            padding: 0 20px;   /* å†…è¾¹è·ï¼Œé˜²æ­¢å†…å®¹ç´§è´´è¾¹ç¼˜ */
        }
        
        
        
        .date-nav {
            border-radius: 2px; /* åœ†è§’æ•ˆæœ */
            box-shadow: 0 0 0 2px black; /* æ¨¡æ‹Ÿ outline */
    display: flex;
    flex-direction: column; /* å‚ç›´æ’åˆ—å¹´ä»½å’Œæ—¥æœŸå¯¼èˆª */
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    background-color: #fec04e;
    color: #221f1f;
}

.year-line {
    font-weight: bold;
    font-size: 12px;
    align-self: baseline;
}

.date-line {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%; /* ä½¿ç®­å¤´å’Œæ—¥æœŸå¯¼èˆªå±…ä¸­åˆ†å¸ƒ */
}

.arrow {
    cursor: pointer;
    font-size: 20px;
    padding: 0 10px;
}

.days {
    display: flex;
            justify-content: space-between;
            flex-grow: 1;
            margin: 0 10px;
}
        .day {
            position: relative;
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
                .todo-item:hover .todo-buttons, .todo-item.editing .todo-buttons {
            display: inline-block;
        }
        .todo-buttons {
            display: none;
        }
        
        .day:hover {
            background-color: #ffda97;
            border-radius: 6px;
                                    color: #221f1f;
        }
        .active {
            background-color: #ffda97;
            font-weight: bold;
            border-radius: 6px;
                                    color: #221f1f;
        
        }
        .today {
            font-weight: bold;
        }
        .badge {
            position: absolute;
            top: 5px;
            right: 10px;
            background-color: #FF4351;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
        }
        .todo-container {
            margin-top: 20px;
        
            padding-right: 20px;
        
            padding-left: 20px;
            background-color: #f9f9f9;
            border-radius: 2px; /* åœ†è§’æ•ˆæœ */
            box-shadow: 0 0 0 2px black; /* æ¨¡æ‹Ÿ outline */
        }
        /* æ–°å¢æ ·å¼ä»¥è°ƒæ•´æ—¥æœŸé€‰æ‹©å™¨çš„ä½ç½® */
        .date-picker-container {
            display: flex;
            align-items: center;
            margin-left: 10px; /* è°ƒæ•´é—´è· */
        }
        #datePicker {
            display: none; /* åˆå§‹éšè— */
          /* margin-right: 10px;  æŒ‰é’®ä¸æ—¥æœŸé€‰æ‹©å™¨ä¹‹é—´çš„é—´è· */
        }
        .todo-item {
            display: flex;
            align-items: center;
            border-bottom: 1px solid #ccc;
            justify-content: space-between;
        }
        .todo-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            margin-right: 10px;
        }
        .todo-text {
            flex-grow: 1;
            color: #131315;
            font-family: sans-serif;
        
        font-size: 16px;
        padding-top: 8px;
            padding-right: 15px;
            padding-bottom: 8px;
            padding-left: 1px;
            margin-right: 10px;
            border: none;
            outline: none;
            background-color: #fff;
        }
        .todo-text[disabled] {
            background-color: #f9f9f9;
        }
        .completed {
            text-decoration: line-through;
            color: #888;
        }
        
        .todo-buttons .delete-confirm {
            background-color: #FF4351 ;
            color: white;
            border-color: #FF4351;
            border: none;
            background: #FF4351;
        }
        
        
        .todo-buttons button {
            animation-name: glowing-primary;
            border-color: #088ef0;
            background: linear-gradient(#34a5f8, #088ef0);
            color: #FFF;
            margin: 2.5px;
            border-style: solid;
            border-width: 1px;
            line-height: 25px;
            border-radius: 4px;
            text-align: center;
            border: none;
        }
        
        .calendar-day.today {
            background-color: #fffeaa; /* ä»Šæ—¥çš„èƒŒæ™¯ */
            color: black; /* åè‰²æ˜¾ç¤º */
            font-size: 12px;
            white-space: nowrap;
        }
        .calendar-nav {
            display: flex;
            justify-content: center; /* ä¸­å¿ƒå¯¹é½ */
            align-items: center;
            padding: 28px; /* æ·»åŠ å†…è¾¹è· */
            background-color: #fec04e;
            border-radius: 2px; /* åœ†è§’æ•ˆæœ */
            box-shadow: 0 0 0 2px black; /* æ¨¡æ‹Ÿ outline */
            color: #221f1f;
            font-weight: bold;
        }
        
        .calendar-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-weight: bold;
            padding-top: 28px;
            padding-bottom: 28px;
        }
        
        .calendar-body {
            display: grid;
            grid-template-columns: repeat(7, 1fr); /* ä¸ƒåˆ— */
            grid-template-rows: repeat(autofill, 1fr); /* è¡Œè‡ªé€‚åº” */
            height: auto; 
        
            gap: 10px; /* å¯é€‰ï¼Œè®¾ç½®æ ¼å­ä¹‹é—´çš„é—´è· */
        
        }
        
        .calendar-day {
            border: 1px solid #ddd;
            padding: 10px;
            position: relative;
        font-size: 12px;
            white-space: nowrap;         /* ç¦ç”¨æ¢è¡Œ */
            overflow: hidden;           /* éšè—æº¢å‡ºçš„å†…å®¹ */
        }
        #addTodo {
            width: 100%;
            margin-top: 10px;
            border-radius: 2px; /* åœ†è§’æ•ˆæœ */
            box-shadow: 0 0 0 2px black; /* æ¨¡æ‹Ÿ outline */
            padding: 10px 15px;
            background-color: #A5DE37;
            color: black;
            border: none;
            cursor: pointer;
            text-align: center;
            font-size: 16px;
        }
        #addTodo:hover {
            background-color: #b9e563
        }


        #config-modal {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 20px;
    border-radius: 2px; /* åœ†è§’æ•ˆæœ */
    box-shadow: 0 0 0 2px black; /* æ¨¡æ‹Ÿ outline */
    background-color: #fff;
    /*box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);*/
    width: 600px;
    height: 336px; /* å›ºå®šé«˜åº¦ä¸º600px */
    overflow: hidden; /* é˜²æ­¢å†…å®¹æº¢å‡º */


}

#config-modal label {
    display: block;
    margin-top: 10px;
}

#config-modal .indented-section {
    margin-left: 20px; /* ç¼©è¿›20px */
}

#save-config {
    position: absolute; /* ç»å¯¹å®šä½ */
    bottom: 6px; /* è·ç¦»åº•éƒ¨10px */
    left: 40%; /* æ°´å¹³å±…ä¸­ */
    transform: translateX(-50%); /* é€šè¿‡å¹³ç§»æ¥å®ç°å±…ä¸­ */

    padding: 10px 20px;
    background-color: #A5DE37;
    color: rgb(0, 0, 0);
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    border-radius: 2px; /* åœ†è§’æ•ˆæœ */
    box-shadow: 0 0 0 2px black; /* æ¨¡æ‹Ÿ outline */
    font-family: sans-serif;
}

#save-config:hover {
    background-color: #b9e563;
    
}



#exitconfig {
    position: absolute; /* ç»å¯¹å®šä½ */
    bottom: 6px; /* è·ç¦»åº•éƒ¨10px */
    left: 60%; /* æ°´å¹³å±…ä¸­ */
    transform: translateX(-50%); /* é€šè¿‡å¹³ç§»æ¥å®ç°å±…ä¸­ */

    padding: 10px 20px;
    background-color: #FF4351;
    color: rgb(0, 0, 0);
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    border-radius: 2px; /* åœ†è§’æ•ˆæœ */
    box-shadow: 0 0 0 2px black; /* æ¨¡æ‹Ÿ outline */
    font-family: sans-serif;
}

#exitconfig:hover {
    background-color: #ff7680;
    
}

        
    </style>
</head>
<body>
        <!-- è®¾ç½®éƒ¨åˆ† -->
        <div id="config-modal">
            <!-- Main options -->
            <label>â„¹ï¸ Ctrl + / æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯</label>
            <label><input type="checkbox" id="md-export"> å¯ç”¨mdæ–‡ä»¶å¯¼å‡ºï¼ˆå¿«æ·é”® Ctrl + . ä¸‹è½½mdæ–‡ä»¶ï¼‰</label>
            <label><input type="checkbox" id="new-tab-export"> å¯ç”¨æ–°æ ‡ç­¾é¡µå¯¼å‡ºï¼ˆå¿«æ·é”® Ctrl + . æ‰“å¼€æ–°æ ‡ç­¾é¡µï¼‰</label>
            <label><input type="checkbox" id="gist-sync"> å¯ç”¨Gistä¸Šä¼ ä¸‹è½½ï¼ˆæ‰‹åŠ¨ä¸Šä¼ å¿«æ·é”® Ctrl + .  æ‰‹åŠ¨ä¸‹è½½å¿«æ·é”® Ctrl + Shift + . ï¼‰</label>
            <div id="gist-options" style="display: none;">
                <div class="indented-section">
                    åœ¨<a href="https://gist.github.com/">è¿™é‡Œ</a>åˆ›å»ºä¸€ä¸ªSecret Gistï¼Œåœ¨<a href="https://github.com/settings/tokens/new">è¿™é‡Œ</a>åˆ›å»ºä¸€ä¸ªä»¤ç‰Œï¼ˆåªç”¨ç»™Gistæƒé™ï¼‰
                    <label>
                        Gist_åœ°å€:
                        <input type="text" style="height: auto;width: 290px;"" id="gist-url" placeholder="https://api.github.com/gists/xxxxxxxxxx">
                    </label>
                    <label>
                        Gist_Token:
                        <input type="text" style="height: auto;width: 280px;" id="gist-token" placeholder="ghp_xxxxxxxxxx">
                    </label>
    
                
                
                <label><input type="checkbox" id="auto-upload"> å¯ç”¨è‡ªåŠ¨Gistä¸Šä¼ ï¼ˆåœ¨æ–°è®¾å¤‡ä½¿ç”¨æ—¶è¯·å…ˆå¯ç”¨Gistä¸Šä¼ ä¸‹è½½å¹¶æŒ‰ä¸‹ Ctrl + Shift + . æ‰‹åŠ¨ä¸‹è½½Gistå†…å®¹ï¼Œé¿å…è¦†ç›–çº¿ä¸Šå†…å®¹ï¼‰</label>
                <div class="indented-section">
                    <div id="gist-options2" style="display: none;">
                        <label>
                            è‡ªåŠ¨ä¸Šä¼ é—´éš”ï¼ˆåˆ†é’Ÿï¼‰:
                            <input type="number" style="height: auto;width: 50px;" id="upload-interval" min="600" placeholder=">=5">
                        </label>
                    </div>
                </div>
            </div>
            </div>
    
    
            
            <!-- Conditional options for gist sync -->
    
    
            <!-- Save and exit button -->
            <button id="save-config">ä¿å­˜å¹¶é€€å‡º</button>
            <button id="exitconfig">é€€å‡º</button>
        </div>
    
    <!-- æ—¥æœŸå¯¼èˆªéƒ¨åˆ† -->
    <div class="date-nav">
        <div id="yearDisplay" class="year-line"></div> <!-- æ˜¾ç¤ºå¹´ä»½çš„ç¬¬ä¸€è¡Œ -->
        
        <div class="date-line">
            <span class="arrow" id="prevDay">&lt;</span>
            <div class="days" id="daysContainer">
                <!-- æ—¥æœŸå°†ä¼šåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <span class="arrow" id="nextDay">&gt;</span>
        </div>
    </div>

    <!-- å¾…åŠåˆ—è¡¨éƒ¨åˆ† -->
    <div class="todo-container" id="todoContainer">
        <!-- å¾…åŠäº‹é¡¹å°†ä¼šåœ¨è¿™é‡Œç”Ÿæˆ -->
    </div>
    <!-- æ—¥å†è§†å›¾éƒ¨åˆ† -->
    <div id="calendarView" style="display: none;">
        <div class="calendar-nav">
            <span class="arrow" id="prevMonth">&lt;</span>
            <span id="viewLabel">å‘¨è§†å›¾</span>
            <span class="arrow" id="nextMonth">&gt;</span>
        </div>
        <div class="calendar-header">
            <span>å‘¨ä¸€</span>
            <span>å‘¨äºŒ</span>
            <span>å‘¨ä¸‰</span>
            <span>å‘¨å››</span>
            <span>å‘¨äº”</span>
            <span>å‘¨å…­</span>
            <span>å‘¨æ—¥</span>
        </div>
        <div class="calendar-body" id="calendarBody">
            <!-- æ—¥å†å¤©æ•°å°†ä¼šåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>
    <button id="chooseDateBtn" style="display: none;">é€‰æ‹©æ—¥æœŸ</button>
    <input type="date" id="datePicker" style="display: none;">
    <button id="addTodo">â•</button>
    <button id="calendarViewBtn">ğŸ“…æ—¥å†è§†å›¾</button>
    <div id="upload-status" class="status"></div>








    <script>
        //var gistUrl = 'https://api.github.com/gists/xxxxxxxxxx'; // æ›¿æ¢ä¸ºä½ çš„ Gist URLï¼Œåœ¨è¿™é‡Œåˆ›å»ºä¸€ä¸ªsecret gistï¼š https://gist.github.com/
        //var token = 'ghp_xxxxxxxxxx'; // æ›¿æ¢ä¸ºä½ çš„ GitHub è®¿é—®ä»¤ç‰Œï¼Œåœ¨è¿™é‡Œåˆ›å»ºä¸€ä¸ªä»¤ç‰Œï¼Œåªç”¨ç»™gistæƒé™ï¼šhttps://github.com/settings/tokens/new
            //var backuptab = false; // è®¾ç½®æ–°æ ‡ç­¾é¡µæ–‡æœ¬æ˜¾ç¤ºå¼€å…³
            //var backupgist = false // è®¾ç½®gistå¤‡ä»½å¼€å…³
            //var backupgistcycle = 120000 // è®¾ç½®gistè‡ªåŠ¨å¤‡ä»½é—´éš”ï¼Œæ¯«ç§’å•ä½ï¼Œå°äº60ç§’å°†ä¸å¯ç”¨è‡ªåŠ¨gistå¤‡ä»½
            //var backupmd = false; // è®¾ç½®mdæ–‡ä»¶å¤‡ä»½å¼€å…³




        // è·å–å…ƒç´ 
            const chooseDateBtn = document.getElementById('chooseDateBtn');
            const datePicker = document.getElementById('datePicker');
            let editingTodoId = null; // ç”¨äºä¿å­˜å½“å‰æ­£åœ¨ç¼–è¾‘çš„å¾…åŠé¡¹çš„ID
        
            // æ—¥æœŸé€‰æ‹©æŒ‰é’®äº‹ä»¶ï¼Œç‚¹å‡»åå¼¹å‡ºæ—¥æœŸé€‰æ‹©å™¨
            chooseDateBtn.addEventListener('click', () => {
                if (editingTodoId !== null) {
        const todo = todosByDate[currentSelectedDate].find(todo => todo.id === editingTodoId);
        if (todo) {
        if (todo) {
            // æ˜¾ç¤ºæ—¥æœŸé€‰æ‹©å™¨å¹¶è®¾ç½®é»˜è®¤å€¼ä¸ºå½“å‰å¾…åŠäº‹é¡¹çš„æ—¥æœŸ
            datePicker.value = currentSelectedDate;
            datePicker.style.display = 'inline-block';
            //datePicker.focus(); // ä½¿æ—¥æœŸé€‰æ‹©å™¨è‡ªåŠ¨è·å¾—ç„¦ç‚¹
            }
        }
                }
            });
        
                // ç›‘å¬ç”¨æˆ·é€‰æ‹©æ—¥æœŸçš„äº‹ä»¶
            datePicker.addEventListener('change', (event) => {
                const selectedDate = event.target.value;
        
                if (selectedDate && editingTodoId !== null) {
        updateTodoDate(editingTodoId, selectedDate);
                }
                datePicker.style.display = 'none';
            });
        
        
                let currentDate = new Date(); // å½“å‰æ˜¾ç¤ºçš„å¼€å§‹æ—¥æœŸ
                const daysContainer = document.getElementById("daysContainer");
        
                let todosByDate = {};
                const todoContainer = document.getElementById('todoContainer');
                const addTodoBtn = document.getElementById('addTodo');
                let currentSelectedDate = formatDate(currentDate); // åˆå§‹æ—¥æœŸ
        
                let draggedTodo = null; // å­˜å‚¨è¢«æ‹–åŠ¨çš„å¾…åŠä¿¡æ¯
        
                function loadTodos() {
        const storedData = localStorage.getItem('todosByDate');
        if (storedData) {
            todosByDate = JSON.parse(storedData);
        }
                }
        
              function saveTodos() {
            const todosToSave = {};
            let hasValidTodos = false; // ç”¨äºè·Ÿè¸ªæ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„ todos
        
            for (const date in todosByDate) {
                // è¿‡æ»¤æ‰ç©ºæ–‡æœ¬çš„ todos
                const validTodos = todosByDate[date].filter(todo => todo.text.trim() !== '');
                
                if (validTodos.length > 0) {
        hasValidTodos = true; // å¦‚æœæœ‰æœ‰æ•ˆçš„ todosï¼Œåˆ™æ ‡è®°ä¸º true
        todosToSave[date] = validTodos.map(todo => ({
            id: todo.id,
            text: todo.text,
            completed: todo.completed
            // ä¸å†ä¿å­˜ editing å’Œ deleteConfirmed
        }));
                }
            }
        
            // åªæœ‰åœ¨æœ‰æœ‰æ•ˆ todos çš„æƒ…å†µä¸‹æ‰ä¿å­˜åˆ° localStorage
            if (hasValidTodos) {
                localStorage.setItem('todosByDate', JSON.stringify(todosToSave));
        
            } else {
                // å¦‚æœæ²¡æœ‰æœ‰æ•ˆçš„ todosï¼Œåˆ™æ¸…ç©º localStorage
                localStorage.removeItem('todosByDate');
        
            }
        }
        
                function formatDate(date) {
        const offsetDate = new Date(date.getTime() + (8 * 60 * 60 * 1000)); // Offset for GMT+8
        return offsetDate.toISOString().split('T')[0]; // è¿”å› YYYY-MM-DD æ ¼å¼
                }
        
                // ç”Ÿæˆ7å¤©çš„æ—¥æœŸæ˜¾ç¤º (å§‹ç»ˆä»¥å‘¨ä¸€ä¸ºå¼€å§‹)
                function updateDays() {
    daysContainer.innerHTML = '';

        // è®¾ç½®å¹´ä»½æ˜¾ç¤º
        const yearDisplay = document.getElementById("yearDisplay");
    yearDisplay.textContent = "ğŸ§­"+currentDate.getFullYear(); // è·å–å½“å‰æ˜¾ç¤ºå¹´ä»½å¹¶æ›´æ–°
    
    const dayOfWeek = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
    let tempDate = new Date(currentDate);
    const dayOffset = tempDate.getDay() === 0 ? 6 : tempDate.getDay() - 1;
    tempDate.setDate(tempDate.getDate() - dayOffset); // å›åˆ°å‘¨ä¸€

    for (let i = 0; i < 7; i++) {
        const dayDiv = document.createElement('div');
        dayDiv.className = 'day';
        const formattedDate = formatDate(tempDate);

        dayDiv.innerHTML = `${dayOfWeek[tempDate.getDay()]}<br>${tempDate.getMonth() + 1}-${tempDate.getDate()}`;
        dayDiv.setAttribute("data-date", formattedDate);

        const pendingTodos = (todosByDate[formattedDate] || []).filter(todo => !todo.completed).length;
        if (pendingTodos > 0) {
            const badge = document.createElement('span');
            badge.className = 'badge';
            badge.textContent = pendingTodos;
            dayDiv.appendChild(badge);
        }

        dayDiv.addEventListener('dragover', (e) => e.preventDefault());
        dayDiv.addEventListener('drop', (e) => handleDrop(e, formattedDate));
        dayDiv.addEventListener('click', (e) => {
            const selectedDate = e.target.getAttribute("data-date");
            Array.from(daysContainer.children).forEach(d => d.classList.remove('active'));
            e.target.classList.add('active');

            showTodoList(selectedDate);
        });

        // é‡æ–°æ£€æŸ¥ä»Šå¤©æ—¥æœŸçš„æ ‡è®°
        if (formattedDate === formatDate(new Date())) {
            dayDiv.classList.add('today');
        }

        // ç¡®ä¿æ–°é€‰æ‹©çš„æ—¥æœŸé«˜äº®æ˜¾ç¤º
        if (formattedDate === currentSelectedDate) {
            dayDiv.classList.add('active');
        }

        daysContainer.appendChild(dayDiv);
        tempDate.setDate(tempDate.getDate() + 1);
    }
}

        
                function showTodoList(date) {
        currentSelectedDate = date;
        
        renderTodoList();
                }
        
                function renderTodoList() {
        todoContainer.innerHTML = '';
        const todos = todosByDate[currentSelectedDate] || [];
        
        const uncompletedTodos = todos.filter(todo => !todo.completed);
        const completedTodos = todos.filter(todo => todo.completed);
        
        uncompletedTodos.forEach(todo => createTodoElement(todo));
        completedTodos.forEach(todo => createTodoElement(todo));
            // èšç„¦åˆ°æœ€åä¸€ä¸ªæ–°å¢çš„æˆ–æ­£åœ¨ç¼–è¾‘çš„å¾…åŠ
            const editingTodo = todos.find(todo => todo.editing);
            if (editingTodo) {
                const inputField = Array.from(todoContainer.children).find(item => item.querySelector('.todo-text').value === editingTodo.text);
                if (inputField) {
        inputField.querySelector('.todo-text').focus();
        
        
                }
            } else {
                const lastTodo = Array.from(todoContainer.children).slice(-1)[0];
                if (lastTodo) {
        lastTodo.querySelector('.todo-text').focus();
                }
            }
        
        updateDays();
        saveTodos();
                }
        
                function createTodoElement(todo) {
        const todoElement = document.createElement('div');
        todoElement.className = 'todo-item';
        todoElement.setAttribute('draggable', true);
        todoElement.addEventListener('dragstart', () => handleDragStart(todo));
        
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.className = 'todo-checkbox';
        checkbox.checked = todo.completed;
        checkbox.addEventListener('click', () => toggleComplete(todo.id));
        todoElement.appendChild(checkbox);
        
        const input = document.createElement('input');
        input.type = 'text';
        input.className = 'todo-text';
        input.value = todo.text;
        input.disabled = !todo.editing;
        if (todo.completed) input.classList.add('completed');
        input.addEventListener('dblclick', () => editTodoText(todo.id)); // åŒå‡»è¿›å…¥ç¼–è¾‘æ¨¡å¼
        todoElement.appendChild(input);
        
        const buttonContainer = document.createElement('div');
        buttonContainer.className = 'todo-buttons';
        
        if (todo.editing) {
            todoElement.classList.add('editing');
                        todoElement.setAttribute('draggable', false);
        
            // åˆ›å»ºé€‰æ‹©æ—¥æœŸæŒ‰é’®
            const chooseDateBtn = document.createElement('button');
            chooseDateBtn.textContent = 'é€‰æ‹©æ—¥æœŸ';
        // æ–°å¢æ—¥æœŸé€‰æ‹©å™¨å®¹å™¨
                const datePickerContainer = document.createElement('div');
                datePickerContainer.className = 'date-picker-container';
            // é€‰æ‹©æ—¥æœŸæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶
            chooseDateBtn.addEventListener('click', () => {
                // æ˜¾ç¤ºæ—¥æœŸé€‰æ‹©å™¨å¹¶è®¾ç½®é»˜è®¤å€¼ä¸ºå½“å‰å¾…åŠäº‹é¡¹çš„æ—¥æœŸ
                datePicker.value = currentSelectedDate; // ä½¿ç”¨å½“å‰é€‰å®šçš„æ—¥æœŸ
                datePicker.style.display = 'inline-block'; // æ˜¾ç¤ºæ—¥æœŸé€‰æ‹©å™¨
                //datePicker.focus(); // èšç„¦åˆ°æ—¥æœŸé€‰æ‹©å™¨
                chooseDateBtn.style.display = 'none'; 
        
        
        
              // éå†æ‰€æœ‰æŒ‰é’®ï¼ŒæŸ¥æ‰¾æ–‡æœ¬ä¸ºâ€œç¡®å®šâ€çš„æŒ‰é’®      
        const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
        if (button.textContent.trim() === 'ç¡®å®š' || button.textContent.trim() === 'åˆ é™¤') {
            button.style.display = 'none'; 
        
        }
            });  
        
        
            });
        
                // å°†æ—¥æœŸé€‰æ‹©å™¨å’ŒæŒ‰é’®æ·»åŠ åˆ°å®¹å™¨ä¸­
                datePickerContainer.appendChild(datePicker);
                datePickerContainer.appendChild(chooseDateBtn);
                buttonContainer.appendChild(datePickerContainer); 
            const saveBtn = document.createElement('button');
            saveBtn.textContent = 'ç¡®å®š';
            saveBtn.addEventListener('click', () => saveTodoText(todo.id, input.value));
        
            buttonContainer.appendChild(saveBtn);
            input.addEventListener('keydown', (event) => {
                if (event.key === 'Enter') {
                    saveTodoText(todo.id, input.value);
                }
            });
            input.focus(); // è‡ªåŠ¨èšç„¦
        } else {
            const editBtn = document.createElement('button');
            editBtn.textContent = 'ç¼–è¾‘';
            editBtn.addEventListener('click', () => {
                editTodoText(todo.id);
                input.focus(); // ç¼–è¾‘æ—¶è‡ªåŠ¨èšç„¦åˆ°è¾“å…¥æ¡†
            });
        
        
        datePicker.addEventListener('change', (event) => {
            const selectedDate = event.target.value;
        
            if (selectedDate && editingTodoId !== null) {
                updateTodoDate(editingTodoId, selectedDate); // æ›´æ–°å¾…åŠäº‹é¡¹çš„æ—¥æœŸ
        
            }
            datePicker.style.display = 'none'; // éšè—æ—¥æœŸé€‰æ‹©å™¨
        });                
            buttonContainer.appendChild(editBtn);
        
        }
        
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = todo.deleteConfirmed ? 'ç¡®è®¤åˆ é™¤' : 'åˆ é™¤';
        datePicker.style.display = 'none';
        
        deleteBtn.classList.toggle('delete-confirm', todo.deleteConfirmed);
        deleteBtn.addEventListener('click', () => {
        
            confirmDelete(todo.id);
        
           const buttons = document.querySelectorAll('button');
            // éå†æ‰€æœ‰æŒ‰é’®ï¼ŒæŸ¥æ‰¾æ–‡æœ¬ä¸ºâ€œç¡®å®šâ€çš„æŒ‰é’®
            buttons.forEach(button => {
                if (button.textContent.trim() === 'é€‰æ‹©æ—¥æœŸ') {
        button.style.display = 'none'; 
                }
            });  
        
        
        });
        
        // æ·»åŠ  mouseenter å’Œ mouseleave äº‹ä»¶ç›‘å¬å™¨
        deleteBtn.addEventListener('mouseenter', () => {
            if (todo.deleteConfirmed) {
                deleteBtn.textContent = 'ç¡®è®¤åˆ é™¤'; // é¼ æ ‡æ‚¬åœæ—¶ä¿æŒç¡®è®¤åˆ é™¤
            }
        });
        
        deleteBtn.addEventListener('mouseleave', () => {
            deleteBtn.textContent = 'åˆ é™¤'; // é¼ æ ‡ç§»å¼€æ—¶æ¢å¤æ–‡æœ¬
                todo.deleteConfirmed=false;
        });
        
        buttonContainer.appendChild(deleteBtn);
        
        todoElement.appendChild(buttonContainer);
        todoContainer.appendChild(todoElement);
                }
        
                function handleDragStart(todo) {
            const currentDateElement = document.querySelector('.calendar-day.active'); // è·å–å½“å‰é€‰ä¸­æ—¥æœŸçš„å…ƒç´ 
            const currentDate = currentDateElement ? currentDateElement.getAttribute('data-date') : currentSelectedDate; // è·å–å½“å‰é€‰ä¸­æ—¥æœŸ
            draggedTodo = { ...todo, sourceDate: currentDate }; // å°†å½“å‰æ—¥æœŸè®¾ç½®ä¸ºæºæ—¥æœŸ
                }
        
              function handleDrop(event, targetDate) {
            event.preventDefault(); // é˜²æ­¢é»˜è®¤è¡Œä¸º
        
            if (draggedTodo) {
                // ä»åŸæ—¥æœŸä¸­åˆ é™¤
                todosByDate[draggedTodo.sourceDate] = todosByDate[draggedTodo.sourceDate].filter(todo => todo.id !== draggedTodo.id);
                // æ·»åŠ åˆ°ç›®æ ‡æ—¥æœŸ
                todosByDate[targetDate] = todosByDate[targetDate] || [];
                todosByDate[targetDate].push(draggedTodo);
        
                // æ›´æ–°å½“å‰é€‰ä¸­æ—¥æœŸçš„å¾…åŠåˆ—è¡¨
                if (currentSelectedDate === draggedTodo.sourceDate || currentSelectedDate === targetDate) {
        renderTodoList();
                }
        
                draggedTodo = null; // æ¸…ç©ºè¢«æ‹–åŠ¨çš„å¾…åŠä¿¡æ¯
                saveTodos();
                updateDays();
                renderCalendar(); // é‡æ–°æ¸²æŸ“æ—¥å†
        
            }
        }
        
        
                function addNewTodo() {
        const newTodo = {
            id: Date.now(),
            text: '',
            completed: false,
            editing: true,
            deleteConfirmed: false
        };
        // ä¸å°†ç©ºçš„æ–°å¢å¾…åŠå­˜å‚¨
        todosByDate[currentSelectedDate] = todosByDate[currentSelectedDate] || [];
        todosByDate[currentSelectedDate].push(newTodo);
        datePicker.style.display = 'none';
        
        renderTodoList();
        
        const inputFields = document.querySelectorAll('.todo-text');
        inputFields[inputFields.length - 1].focus(); // å…‰æ ‡è‡ªåŠ¨èšç„¦
        
        
        const buttons = document.querySelectorAll('button');
            // éå†æ‰€æœ‰æŒ‰é’®ï¼ŒæŸ¥æ‰¾æ–‡æœ¬ä¸ºâ€œç¡®å®šâ€çš„æŒ‰é’®
            buttons.forEach(button => {
                if (button.textContent.trim() === 'é€‰æ‹©æ—¥æœŸ') {
        button.style.display = 'none'; 
                }
            });  
        
                
        
        
                }
        
                function toggleComplete(id) {
        todosByDate[currentSelectedDate] = todosByDate[currentSelectedDate].map(todo => {
            if (todo.id === id) {
                todo.completed = !todo.completed;
            }
            return todo;
        });
        renderTodoList();
                }
        
                function saveTodoText(id, newText) {
            todosByDate[currentSelectedDate] = todosByDate[currentSelectedDate].map(todo => {
                if (todo.id === id) {
        if (!newText.trim()) {
            return null; // å¦‚æœæ–‡æœ¬ä¸ºç©ºï¼Œåˆ™åˆ é™¤å¾…åŠ
        }
        todo.text = newText;
        // ä¸å†ä¿å­˜ editing çŠ¶æ€
        todo.editing = false;
                }
                return todo;
            }).filter(todo => todo !== null); // è¿‡æ»¤æ‰ç©ºæ–‡æœ¬çš„å¾…åŠ
            renderTodoList();
        chooseDateBtn.style.display = 'none'; // éšè— "é€‰æ‹©æ—¥æœŸ" æŒ‰é’®
                editingTodoId = null; // æ¸…ç©ºç¼–è¾‘ä¸­çš„ID
                }
        
                function editTodoText(id) {
            todosByDate[currentSelectedDate] = todosByDate[currentSelectedDate].map(todo => {
                if (todo.id === id) {
        todo.editing = true;
        editingTodoId = id; // ä¿å­˜æ­£åœ¨ç¼–è¾‘çš„å¾…åŠID
                }
                return todo;
            });
        
            chooseDateBtn.style.display = 'none'; // æ˜¾ç¤º "é€‰æ‹©æ—¥æœŸ" æŒ‰é’®
            renderTodoList();
                }
         function updateTodoDate(id, newDate) {
        
                // ä»å½“å‰æ—¥æœŸç§»é™¤è¯¥å¾…åŠäº‹é¡¹
                const todo = todosByDate[currentSelectedDate].find(todo => todo.id === id);
                if (todo) {
        // ä»å½“å‰æ—¥æœŸç§»é™¤è¯¥å¾…åŠäº‹é¡¹
        todosByDate[currentSelectedDate] = todosByDate[currentSelectedDate].filter(todo => todo.id !== id);
        // å°†å¾…åŠäº‹é¡¹æ·»åŠ åˆ°æ–°æ—¥æœŸ
        todosByDate[newDate] = todosByDate[newDate] || [];
        todosByDate[newDate].push(todo);
        currentSelectedDate = newDate; // æ›´æ–°å½“å‰é€‰ä¸­çš„æ—¥æœŸ



// æ£€æŸ¥æ–°æ—¥æœŸæ˜¯å¦åœ¨å½“å‰å‘¨å†…
const selectedDateObj = new Date(newDate);
        const startOfWeek = new Date(currentDate);
        const dayOffset = startOfWeek.getDay() === 0 ? 6 : startOfWeek.getDay() - 1;
        startOfWeek.setDate(startOfWeek.getDate() - dayOffset);  // å½“å‰å‘¨çš„èµ·å§‹æ—¥æœŸ

        const endOfWeek = new Date(startOfWeek);
        endOfWeek.setDate(endOfWeek.getDate() + 6);  // å½“å‰å‘¨çš„ç»“æŸæ—¥æœŸ

        if (selectedDateObj < startOfWeek || selectedDateObj > endOfWeek) {
            // å¦‚æœæ–°æ—¥æœŸä¸åœ¨å½“å‰æ˜¾ç¤ºçš„å‘¨å†…ï¼Œæ›´æ–°currentDateä¸ºæ–°æ—¥æœŸæ‰€åœ¨å‘¨çš„èµ·å§‹
            currentDate = new Date(selectedDateObj);
            currentDate.setDate(currentDate.getDate() - (currentDate.getDay() === 0 ? 6 : currentDate.getDay() - 1));
        }








        updateDays();
        renderTodoList();
          const buttons = document.querySelectorAll('button');
        
            // éå†æ‰€æœ‰æŒ‰é’®ï¼ŒæŸ¥æ‰¾æ–‡æœ¬ä¸ºâ€œç¡®å®šâ€çš„æŒ‰é’®
            buttons.forEach(button => {
                if (button.textContent.trim() === 'ç¡®å®š') {
        button.click(); // ç‚¹å‡»æŒ‰é’®
                }
            });  
        
                }
                chooseDateBtn.style.display = 'none'; // éšè— "é€‰æ‹©æ—¥æœŸ" æŒ‰é’®
                editingTodoId = null; // æ¸…ç©ºç¼–è¾‘ä¸­çš„ID
            }
                function confirmDelete(id) {
                
        
        todosByDate[currentSelectedDate] = todosByDate[currentSelectedDate].map(todo => {
        
            if (todo.id === id) {
                if (todo.deleteConfirmed) {
                    return null;
                    
                }
                todo.deleteConfirmed = true;
            }
        
            return todo;
        }).filter(todo => todo !== null);
        
        
        renderTodoList();
                }
        
                document.getElementById("prevDay").addEventListener('click', () => {
        currentDate.setDate(currentDate.getDate() - 7);
        updateDays();
                });
        
                document.getElementById("nextDay").addEventListener('click', () => {
        currentDate.setDate(currentDate.getDate() + 7);
        updateDays();
                });
        
                addTodoBtn.addEventListener('click', addNewTodo);
        
                function moveUncompletedTodosToToday() {
        const today = formatDate(new Date());
        for (let date in todosByDate) {
            if (date < today) {
                const uncompletedTodos = todosByDate[date].filter(todo => !todo.completed);
                if (uncompletedTodos.length > 0) {
                    todosByDate[today] = (todosByDate[today] || []).concat(uncompletedTodos);
                    todosByDate[date] = todosByDate[date].filter(todo => todo.completed);
                }
            }
        }
                }
        
                loadTodos();
                moveUncompletedTodosToToday();
                updateDays();
                renderTodoList();
        
        
        
        
        let isCalendarView = false; // è·Ÿè¸ªæ˜¯å¦åœ¨æ—¥å†è§†å›¾ä¸­
        const calendarViewBtn = document.getElementById("calendarViewBtn");
        const calendarBody = document.getElementById("calendarBody");
        const viewLabel = document.getElementById("viewLabel");
        
        calendarViewBtn.addEventListener('click', toggleCalendarView);
        document.getElementById("prevMonth").addEventListener('click', () => changeMonth(-1));
        document.getElementById("nextMonth").addEventListener('click', () => changeMonth(1));
        
        function toggleCalendarView() {
            isCalendarView = !isCalendarView;
            document.getElementById("todoContainer").style.display = isCalendarView ? 'none' : 'block';
            document.getElementById("calendarView").style.display = isCalendarView ? 'block' : 'none';
        // æ§åˆ¶æ—¥æœŸå¯¼èˆªçš„æ˜¾ç¤ºä¸éšè—
            document.querySelector('.date-nav').style.display = isCalendarView ? 'none' : 'flex';
                calendarViewBtn.textContent = isCalendarView ? 'ğŸ•”ï¸å‘¨è§†å›¾' : 'ğŸ“…æ—¥å†è§†å›¾';
        const addTodoButton = document.getElementById("addTodo");
            addTodoButton.style.display = isCalendarView ? 'none' : 'block';
        
        
            if (isCalendarView) {
                renderCalendar();
            }
        
                if (!isCalendarView) {
                //location.reload(); // Reloads the current page
                currentSelectedDate = formatDate(currentDate); // è®¾ç½®å½“å‰é€‰ä¸­æ—¥æœŸä¸ºå½“å‰æ—¥æœŸ
                            updateDays();
            renderTodoList()
                //renderTodoList();  æ¸²æŸ“å¾…åŠäº‹é¡¹åˆ—è¡¨
                //renderCalendar();
            }
        }
        
        let currentMonth = new Date(); // å½“å‰æ˜¾ç¤ºçš„æœˆä»½
        
        function changeMonth(direction) {
            currentMonth.setMonth(currentMonth.getMonth() + direction);
            renderCalendar();
        }
        function updateViewLabel(year, month) {
            const viewLabel = document.getElementById("viewLabel");
            viewLabel.textContent = `${year}å¹´${month}æœˆ`;
        }
        
        
        function renderCalendar() {  
            calendarBody.innerHTML = '';
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            const now = new Date();
            updateViewLabel(year, month+1);
        
            // è·å–å½“æœˆç¬¬ä¸€å¤©
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0); // è·å–ä¸Šä¸ªæœˆæœ€åä¸€å¤©
            const startDay = firstDay.getDay(); // å‘¨å‡ å¼€å§‹
        
        
            // æ·»åŠ å‰ç½®ç©ºæ ¼
            for (let i = 1; i < startDay; i++) {
                const emptyDay = document.createElement('div');
                calendarBody.appendChild(emptyDay);
            }
        
            // æ·»åŠ æ¯ä¸€å¤©çš„æ•°å­—
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                dayDiv.textContent = day;
        
                // æ ‡è®°ä»Šå¤©
                if (day === new Date().getDate() && month === new Date().getMonth() && year === new Date().getFullYear()) {
        dayDiv.classList.add('today');
                }
        
                // æ·»åŠ å¾…åŠäº‹é¡¹
        const formattedDate = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
        const todos = todosByDate[formattedDate] || [];
        todos.forEach(todo => {
            const todoText = document.createElement('div');
            todoText.textContent = `Â· ${todo.text}`; // æ·»åŠ ç¬¦å·
            if (todo.completed) {
                todoText.classList.add('completed');
            }
         // è®¾ç½®ä¸ºå¯æ‹–åŠ¨
        
        todoText.setAttribute('draggable', true);
        
        
        
        
        
        
        
        
        
        let isDragging = false;
        let clickCount = 0; // è®°å½•ç‚¹å‡»æ¬¡æ•°
        
        todoText.addEventListener('dragstart', (e) => {
            isDragging = true; // è®¾ç½®æ‹–åŠ¨æ ‡å¿—
        
            handleDragStart(todo); // æ‹–åŠ¨å¼€å§‹
        });
        
        dayDiv.addEventListener('mousedown', () => {
            clickCount = 0; // é‡ç½®ç‚¹å‡»æ¬¡æ•°
            currentSelectedDate = formattedDate; // æ›´æ–°å½“å‰é€‰ä¸­æ—¥æœŸ
        
            renderCalendar(); // é‡æ–°æ¸²æŸ“æ—¥å†ä»¥é«˜äº®æ˜¾ç¤ºé€‰ä¸­æ—¥æœŸ
        });
        
        todoText.addEventListener('mousedown', () => {
            clickCount++; // å¢åŠ ç‚¹å‡»æ¬¡æ•°
        
            if (clickCount === 2) { // æ£€æµ‹åŒå‡»
        
                if (!isDragging) { // å¦‚æœæ²¡æœ‰æ‹–åŠ¨ï¼Œæ‰§è¡ŒåŒå‡»äº‹ä»¶
        toggleComplete(todo.id); // åˆ‡æ¢ä»»åŠ¡çŠ¶æ€
        renderCalendar(); // æ›´æ–°æ—¥å†è§†å›¾
                }
                clickCount = 0; // é‡ç½®ç‚¹å‡»æ¬¡æ•°
            }
        });
        
        // æ‹–åŠ¨ç»“æŸæ—¶é‡ç½®æ‹–åŠ¨æ ‡å¿—
        todoText.addEventListener('dragend', () => {
            isDragging = false; // é‡ç½®æ‹–åŠ¨çŠ¶æ€
        });
        
        
        
        
        
        
        
        
        
            // æ›´æ–° currentSelectedDate
        
        dayDiv.appendChild(todoText);
                });
        
        
        
            // æ›´æ–°å½“å‰é€‰ä¸­æ—¥æœŸ
        
        
        
        
        
                dayDiv.setAttribute("data-date", formattedDate);
                dayDiv.addEventListener('dragover', (e) => e.preventDefault());
                dayDiv.addEventListener('drop', (e) => handleDrop(e, formattedDate));
                calendarBody.appendChild(dayDiv);
            }
        }
function backupmdornewtab() {
    
                const todosByDate = JSON.parse(localStorage.getItem('todosByDate'));
                let output = '';
 // è·å–æ—¥æœŸå¹¶æ’åº
        const sortedDates = Object.keys(todosByDate).sort((a, b) => new Date(a) - new Date(b));
        
 // éå†æ’åºåçš„æ—¥æœŸ
        for (const date of sortedDates) {
            output += `## ${date}\n\n`;
            const todos = todosByDate[date];
            todos.forEach(todo => {
                const completedMarker = todo.completed ? '[x]' : '[ ]';
                output += `- ${completedMarker} ${todo.text}\n`;
            });
            output += '\n'; // æ·»åŠ ç©ºè¡Œä»¥åˆ†éš”æ—¥æœŸ
        }


           if (globalConfig.backuptab){
                const newTab = window.open();
                newTab.document.write('<pre>' + output.trim() + '</pre>');
                newTab.document.close(); // å…³é—­æ–‡æ¡£æµä»¥å®Œæˆé¡µé¢åŠ è½½
                    }

           if (globalConfig.backupmd) {
        const today = new Date().toISOString().split('T')[0]; // è·å–ä»Šæ—¥æ—¥æœŸ
        const blob = new Blob([output.trim()], { type: 'text/markdown' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `å¤‡ä»½äº${today}.md`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }


}     
function backup2gist() {
    const todosByDate = JSON.parse(localStorage.getItem('todosByDate'));
                let output = '';
 // è·å–æ—¥æœŸå¹¶æ’åº
        const sortedDates = Object.keys(todosByDate).sort((a, b) => new Date(a) - new Date(b));
        
 // éå†æ’åºåçš„æ—¥æœŸ
        for (const date of sortedDates) {
            output += `## ${date}\n\n`;
            const todos = todosByDate[date];
            todos.forEach(todo => {
                const completedMarker = todo.completed ? '[x]' : '[ ]';
                output += `- ${completedMarker} ${todo.text}\n`;
            });
            output += '\n'; // æ·»åŠ ç©ºè¡Œä»¥åˆ†éš”æ—¥æœŸ
        }


    if (globalConfig.backupgist) {
            syncToGist(output.trim());
            console.log("å¼€å§‹å¤‡ä»½")
        }
    
    

}
        document.addEventListener('keydown', function(event) {






            if (event.ctrlKey && event.key === '.' ) {

                backupmdornewtab();
                backup2gist();

            } else if (event.ctrlKey && event.key === '/') {
                const helpTab = window.open();
                helpTab.document.write(`
        <html>
            <head>
                <title>ä½¿ç”¨è¯´æ˜</title>
                
        
        
            </head>
            <body>
                <h1>ä½¿ç”¨è¯´æ˜</h1>
                <p>1. ç‚¹å‡»æ—¥æœŸå¯ä»¥åˆ‡æ¢æ—¥æœŸï¼Œç‚¹å‡»<>å¯ä»¥åˆ‡æ¢ä¸Šä¸€å‘¨ã€ä¸‹ä¸€å‘¨</p>
                <p>2. ç‚¹å‡»+æ–°å¢å¾…åŠ</p>
                <p>3. ç‚¹å‡»ç¼–è¾‘æŒ‰é’®ä¿®æ”¹å¾…åŠå†…å®¹</p>
                <p>4. ç‚¹å‡»é€‰æ‹©æ—¥æœŸï¼Œå¯ä»¥å°†ä»»åŠ¡ç§»åŠ¨åˆ°å…¶ä»–æ—¥æœŸ</p>
                <p>5. å¯ä»¥æ‹–åŠ¨ä»»åŠ¡åˆ°å…¶ä»–æ—¥æœŸ</p>
                <p>6. å‰æœŸæœªå®Œæˆçš„ä»»åŠ¡ä¼šè‡ªåŠ¨è½¬ç§»åˆ°ä»Šå¤©ï¼Œå·²å®Œæˆçš„ä¸ä¼šè½¬ç§»</p>
                <p>7. ç‚¹å‡»æ—¥å†è§†å›¾å¯ä»¥çœ‹æ•´ä¸ªæœˆå·²å®Œæˆã€æœªå®Œæˆçš„ä»»åŠ¡</p>
                <p>8. æ—¥å†è§†å›¾ä¸‹ï¼Œå¯ä»¥æ‹–åŠ¨æ”¹å˜ä»»åŠ¡æ—¥æœŸ</p>
                <p>9. ctrl+. å¯ä»¥ä»¥markdownæ ¼å¼å¯¼å‡ºæ‰€æœ‰ä»»åŠ¡ã€ä¸Šä¼ Gistå¤‡ä»½ï¼Œåœ¨æ–°æ ‡ç­¾é¡µæ˜¾ç¤ºæ‰€æœ‰ä»»åŠ¡</p>
                <p>10. ctrl+/ å¯ä»¥æ˜¾ç¤ºè¯´æ˜ </p>
                <p>11. ctrl+, å¯ä»¥å¯¼å…¥ä»»åŠ¡ï¼ˆæ ¼å¼å¿…é¡»åŒ9å¯¼å‡ºçš„ï¼‰ </p>
            </body>
        </html>
                `);
                helpTab.document.close(); // å…³é—­æ–‡æ¡£æµä»¥å®Œæˆé¡µé¢åŠ è½½
            }
        });
        
        
        
        // ç›‘å¬é”®ç›˜äº‹ä»¶
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey && event.key === ',') {
                // å¼¹å‡ºè¾“å…¥æ¡†
                const userInput = prompt("è¯·è¾“å…¥å¾…åŠäº‹é¡¹ï¼š");
                if (userInput) {
        importTodos(userInput);
                }
            }
        });


        document.addEventListener('keydown', function(event) {
    if (event.ctrlKey  && event.key === '>' && globalConfig.backupgist === true) {
        // è¯»å– Gist å†…å®¹
        fetchGistContent();
    }
})


        
        function importTodos(input) {
            const todosByDate = {};
            let currentId = 1;
        
            // æŒ‰è¡Œåˆ†å‰²è¾“å…¥å†…å®¹
            const lines = input.split('\n');
        
            let currentDate = '';
        
            lines.forEach(line => {
                line = line.trim();
                // åŒ¹é…æ—¥æœŸ
                const dateMatch = line.match(/^## (\d{4}-\d{2}-\d{2})$/);
                if (dateMatch) {
        currentDate = dateMatch[1];
        todosByDate[currentDate] = [];
                }
                // åŒ¹é…å¾…åŠäº‹é¡¹
                const todoMatch = line.match(/^- \[(x| )\] (.+)$/);
                if (todoMatch && currentDate) {
        const completed = todoMatch[1] === 'x';
        const text = todoMatch[2];
        
        // æ·»åŠ å¾…åŠäº‹é¡¹ï¼ˆå¿½ç•¥ IDï¼‰
        todosByDate[currentDate].push({
            id: currentId++, // ç”Ÿæˆæ–° ID
            text: text,
            completed: completed
        });
                }
            });
        
            // å­˜å‚¨åˆ° localStorage
            localStorage.setItem('todosByDate', JSON.stringify(todosByDate));
            console.log('å¾…åŠäº‹é¡¹å·²å¯¼å…¥:', todosByDate);

            //location.reload();
        }


        
function syncToGist(content) {
    const statusElement = document.getElementById('upload-status'); // è·å–çŠ¶æ€å…ƒç´ 
    const currentTime = new Date().toLocaleTimeString(); // è·å–å½“å‰æ—¶é—´
    statusElement.textContent = `${currentTime} â«æ­£åœ¨å°†æ•°æ®ä¸Šä¼ Gist`; // è®¾ç½®åˆå§‹çŠ¶æ€

    fetch(globalConfig.gistUrl, {
        method: 'PATCH',
        headers: {
            'Authorization': `token ${globalConfig.token}`,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            files: {
                'todos.md': {
                    content: content
                }
            }
        })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Failed to sync with Gist');
        }
        return response.json();
    })
    .then(data => {
        const currentTime = new Date().toLocaleTimeString(); // è·å–å½“å‰æ—¶é—´
        statusElement.textContent = `${currentTime} âœ… Gistä¸Šä¼ æˆåŠŸ`; // æ˜¾ç¤ºæˆåŠŸçŠ¶æ€
        //setTimeout(() => {
        //statusElement.textContent = ''; // 10ç§’åæ¸…ç©ºçŠ¶æ€
        //}, 5000); // 10000æ¯«ç§’ = 10ç§’
        console.log('Gist updated:', data.html_url);
    })
    .catch(error => {
        const currentTime = new Date().toLocaleTimeString(); // è·å–å½“å‰æ—¶é—´
        statusElement.textContent = `${currentTime} âŒ Gistä¸Šä¼ å¤±è´¥ï¼Œè¯·æ£€æŸ¥è®¾ç½®`; // æ˜¾ç¤ºå¤±è´¥çŠ¶æ€
        console.error('Error syncing with Gist:', error);
    });
}


// ä» Gist è·å–å†…å®¹çš„å‡½æ•°
function fetchGistContent() {
    const statusElement = document.getElementById('upload-status'); // è·å–çŠ¶æ€å…ƒç´ 
    const currentTime = new Date().toLocaleTimeString(); // è·å–å½“å‰æ—¶é—´
    
    statusElement.textContent = `${currentTime} â¬æ­£åœ¨ä»Gistä¸‹è½½æ•°æ®`; // è®¾ç½®åˆå§‹çŠ¶æ€
    fetch(globalConfig.gistUrl, {
        method: 'GET', // æŒ‡å®šè¯·æ±‚æ–¹æ³•
        headers: {
            'Authorization': `token ${globalConfig.token}`
        },
        cache: 'no-cache' // å¿½ç•¥ç¼“å­˜ï¼Œå¼ºåˆ¶è¯·æ±‚æœ€æ–°æ•°æ®
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Failed to fetch Gist content');
            statusElement.textContent = `${currentTime} âŒ Gistä¸‹è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥è®¾ç½®`; // 
        }
        return response.json();
    })
    .then(data => {
        const content = data.files['todos.md'].content; // è·å–æ–‡ä»¶å†…å®¹
        console.log('Fetched content from Gist:', content); // è¾“å‡ºå†…å®¹
        importTodos(content)
        const currentTime = new Date().toLocaleTimeString(); // è·å–å½“å‰æ—¶é—´
        statusElement.textContent = `${currentTime} âœ…ä»Gistè¯»å–æˆåŠŸ`; // æ˜¾ç¤ºå¤±è´¥çŠ¶æ€
        loadTodos();
        renderTodoList();
        setTimeout(() => {
        statusElement.textContent = ''
        }, 5000); // 10000æ¯«ç§’ = 10ç§’
    })
    .catch(error => {
        console.error('Error fetching Gist content:', error);
        statusElement.textContent = `${currentTime} âŒ Gistä¸‹è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥è®¾ç½®`; // 
    });
}


// å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡æ¥å­˜å‚¨é…ç½®
let globalConfig = {};

// å‡½æ•°ç”¨äºä» localStorage è¯»å–é…ç½®
function loadConfig() {
    // ä» localStorage ä¸­è·å– config å­—ç¬¦ä¸²
    const configString = localStorage.getItem('config');



    // æ£€æŸ¥æ˜¯å¦æˆåŠŸè·å–åˆ°é…ç½®
    if (configString) {
        try {
            // è§£æ JSON å­—ç¬¦ä¸²ä¸ºå¯¹è±¡
            const configObject = JSON.parse(configString);

            // å°†é…ç½®å¯¹è±¡èµ‹å€¼ç»™å…¨å±€å˜é‡
            globalConfig = {
                backupgist: configObject.gistSync || false,
                backuptab : configObject.newTabExport || false,
                backupmd: configObject.mdExport || false,
                autoUpload: configObject.autoUpload || false,
                backupgistcycle: configObject.uploadInterval || '',
                gistUrl: configObject.gistUrl || '',
                token: configObject.gistToken || '',
            };

            console.log('é…ç½®åŠ è½½æˆåŠŸ:', globalConfig);
    document.getElementById('gist-sync').checked = globalConfig.backupgist;
    document.getElementById('new-tab-export').checked = globalConfig.backuptab;
    document.getElementById('md-export').checked = globalConfig.backupmd;
    document.getElementById('auto-upload').checked = globalConfig.autoUpload;
    document.getElementById('upload-interval').value = globalConfig.backupgistcycle;
    document.getElementById('gist-url').value = globalConfig.gistUrl;
    document.getElementById('gist-token').value = globalConfig.token;
        } catch (error) {
            console.error('è§£æé…ç½®æ—¶å‡ºé”™:', error);
        }
    } else {
        console.warn('æœªæ‰¾åˆ°é…ç½®é¡¹');
    }
}

window.onload = function() {
    loadConfig();
    const statusElement = document.getElementById('upload-status'); // è·å–çŠ¶æ€å…ƒç´ 
    

      if (globalConfig.backupgistcycle >= 5 && globalConfig.autoUpload === true ) {

        const currentTime = new Date().toLocaleTimeString(); // è·å–å½“å‰æ—¶é—´
        statusElement.textContent = `${currentTime} ğŸ”å·²å¯ç”¨è‡ªåŠ¨ä¸Šä¼ Gistï¼ˆé—´éš” ${globalConfig.backupgistcycle} åˆ†é’Ÿï¼Œ5såå¼€å§‹ç¬¬ä¸€æ¬¡ä¸Šä¼ ï¼‰ `; // è®¾ç½®åˆå§‹çŠ¶æ€
        setTimeout(() => {
            backup2gist();
        }, 5000); // 10000æ¯«ç§’ = 10ç§’

        setInterval(backup2gist, globalConfig.backupgistcycle*60000);
      } else {
        const currentTime = new Date().toLocaleTimeString(); // è·å–å½“å‰æ—¶é—´
        statusElement.textContent = `${currentTime} â„¹ï¸æœªå¯ç”¨è‡ªåŠ¨ä¸Šä¼ Gistï¼Œè¯·å®šæœŸæ‰‹åŠ¨å¤‡ä»½ï¼ˆæŒ‰ Ctrl + Shift + ? é…ç½®å¤‡ä»½æ–¹å¼ï¼‰`; // è®¾ç½®åˆå§‹çŠ¶æ€
        //setTimeout(() => {
        //statusElement.textContent = ''; // 10ç§’åæ¸…ç©ºçŠ¶æ€
        //}, 5000); // 10000æ¯«ç§’ = 10ç§’
      }

    };



//è®¾ç½®åŠŸèƒ½éƒ¨åˆ†



document.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.shiftKey && e.key === '?') {
            document.getElementById('config-modal').style.display = 'block';
            document.getElementById('gist-options').style.display = globalConfig.backupgist ? 'block' : 'none';
            document.getElementById('gist-options2').style.display = globalConfig.autoUpload ? 'block' : 'none';

        }
    });


    // æ ¹æ®é€‰é¡¹çš„åˆå§‹çŠ¶æ€è®¾ç½®ç›¸åº”çš„æ˜¾ç¤ºçŠ¶æ€


    // Toggle gist options visibility
    document.getElementById('gist-sync').addEventListener('change', function() {
        document.getElementById('gist-options').style.display = this.checked ? 'block' : 'none';

    });

    document.getElementById('auto-upload').addEventListener('change', function() {
        document.getElementById('gist-options2').style.display = this.checked ? 'block' : 'none';

    });

    // Save configuration to localStorage
    document.getElementById('save-config').addEventListener('click', () => {
        const config = {
            gistSync: document.getElementById('gist-sync').checked,
            newTabExport: document.getElementById('new-tab-export').checked,
            mdExport: document.getElementById('md-export').checked,
            autoUpload: document.getElementById('auto-upload').checked,
            uploadInterval: parseInt(document.getElementById('upload-interval').value, 10) || null,
            gistUrl: document.getElementById('gist-url').value || '',
            gistToken: document.getElementById('gist-token').value || ''
        };

        // Save config to localStorage
        localStorage.setItem('config', JSON.stringify(config));
        
        // Refresh the page
        window.location.reload();
    });

    document.getElementById('exitconfig').addEventListener('click', () => {
        document.getElementById('config-modal').style.display = 'none';
    });


        
    </script>
</body>
</html>